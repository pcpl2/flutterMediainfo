name: üèó Make release new version

on:
  workflow_dispatch:
    inputs:
      version:
        description: 'Api version (format: Major.Minor.HotFix-dev.DevVersion, example: 1.2.12 or 1.2.12-dev.2)'
        required: true

jobs:
  build_examples:
    name: Build Examples
    uses: pcpl2/flutterMediainfo/.github/workflows/CI_Build_example.yml@main

  make_release:
    name: Make release on github
    runs-on: ubuntu-latest
    needs: [ build_examples ]
    steps:
      - name: Get all examples
        uses: actions/download-artifact@v3.0.1

      - name: Make zip files
        run: |
          cd FlutterMediaInfo\ Example\ Ubuntu\ 20.04/
          zip -vr ../FlutterMediaInfo-Example-Ubuntu-20.04.zip ./*
          cd ..
          cd FlutterMediaInfo\ Example\ Ubuntu\ 22.04/
          zip -vr ../FlutterMediaInfo-Example-Ubuntu-22.04.zip ./*
          cd ..
          cd FlutterMediaInfo\ Example\ Windows\ 2019/
          zip -vr ../FlutterMediaInfo-Example-Windows-2019.zip ./*
          cd ..
          cd FlutterMediaInfo\ Example\ Windows\ 2022/
          zip -vr ../FlutterMediaInfo-Example-Windows-2022.zip ./*
          cd ..
          mv ./FlutterMediaInfo\ Example\ macOS\ 11/FlutterMediaInfo\ Example\ macos-11.zip ./FlutterMediaInfo-Example-macOS-11.zip
          mv ./FlutterMediaInfo\ Example\ macOS\ 12/FlutterMediaInfo\ Example\ macos-12.zip ./FlutterMediaInfo-Example-macOS-12.zip

      - name: Create release
        id: create_release
        uses: softprops/action-gh-release@v1
        with:
          body: |
              Changelog: TODO
          name: '${{ github.event.inputs.version }}'
          tag_name: '${{ github.event.inputs.version }}'
          draft: true
          prerelease: false
          target_commitish: ${{ github.sha }}
          files: |
            FlutterMediaInfo-Example-Ubuntu-20.04.zip
            FlutterMediaInfo-Example-Ubuntu-22.04.zip
            FlutterMediaInfo-Example-Windows-2019.zip
            FlutterMediaInfo-Example-Windows-2022.zip
            FlutterMediaInfo-Example-macOS-11.zip
            FlutterMediaInfo-Example-macOS-12.zip
